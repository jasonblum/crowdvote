{% extends "base.html" %}

{% block title %}Discover Communities - CrowdVote{% endblock %}

{% block sidebar_content %}
    <!-- Inherit logo from base.html -->
    {{ block.super }}
    
    <!-- Progress Steps -->
    <div class="px-6 py-4">
        <div class="space-y-4">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-white" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-900 dark:text-white">Email Verified</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Account created</p>
                </div>
            </div>
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-white" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-900 dark:text-white">Profile Setup</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Profile completed</p>
                </div>
            </div>
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                    <span class="text-white font-semibold text-sm">3</span>
                </div>
                <div>
                    <p class="text-sm font-medium text-blue-600 dark:text-blue-400">Community Selection</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Join communities</p>
                </div>
            </div>
        </div>
    </div>
{% endblock sidebar_content %}

{% block header_left %}
    <div class="flex items-center">
        <h1 class="text-xl font-bold text-gray-900 dark:text-white">Discover Communities</h1>
    </div>
{% endblock header_left %}

{% block content %}
<div class="py-8 px-6">
    <div class="space-y-8">
        
        <!-- Welcome Message -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-800 dark:text-white mb-4">
                üåç Discover Communities
            </h1>
            <p class="text-xl text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                Join communities where real democracy happens between elections. 
                Vote directly or delegate to trusted experts on topics you care about.
            </p>
        </div>

        <!-- Communities Table -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 p-6 mb-12">
            {% if community_data %}
            <table id="communities-table" class="display w-full">
                <thead>
                    <tr>
                        <th>Community</th>
                        <th>Members</th>
                        <th>Description</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for data in community_data %}
                    <tr>
                        <td>
                            <a href="{% url 'democracy:community_detail' data.community.id %}" class="font-semibold">
                                {{ data.community.name }}
                            </a>
                        </td>
                        <td>{{ data.member_count }}</td>
                        <td>{{ data.community.description|truncatewords:15 }}</td>
                        <td>
                            <div id="community-{{ data.community.id }}-status">
                                {% if not is_authenticated %}
                                    <a href="/" class="btn-primary-sm">Login</a>
                                {% elif data.user_status == 'member' %}
                                    <span class="badge badge-green">‚úÖ Member</span>
                                {% elif data.user_status == 'pending' %}
                                    <span class="badge badge-yellow">‚è≥ Pending</span>
                                {% elif data.user_status == 'rejected' %}
                                    <button hx-post="{% url 'accounts:apply_to_community' data.community.id %}"
                                            hx-target="#community-{{ data.community.id }}-status"
                                            hx-swap="innerHTML"
                                            class="btn-primary-sm">
                                        Reapply
                                    </button>
                                {% else %}
                                    <button hx-post="{% url 'accounts:apply_to_community' data.community.id %}"
                                            hx-target="#community-{{ data.community.id }}-status"
                                            hx-swap="innerHTML"
                                            class="btn-primary-sm">
                                        Apply
                                    </button>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="text-center py-12">
                <p class="text-gray-600 dark:text-gray-400 text-lg">No communities available yet.</p>
                <p class="text-gray-500 dark:text-gray-400 mt-2">Communities will appear here as they're created.</p>
            </div>
            {% endif %}
        </div>
        
        <script>
        $(document).ready(function() {
            if ($('#communities-table').length) {
                $('#communities-table').DataTable({
                    pageLength: 10,
                    lengthMenu: [10, 25, 50, 100],
                    order: [[0, 'asc']], // Sort by community name
                    columnDefs: [
                        { orderable: false, targets: [3] } // Status column not sortable
                    ]
                });
            }
        });
        </script>

        <!-- Coming Soon -->
        <div class="text-center bg-white rounded-xl p-8 shadow-lg border border-gray-200">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">üöß Community Applications Coming Soon</h3>
            <p class="text-gray-600 mb-6">
                We're building the community application system! For now, you can explore our 
                <strong>demo democracy system</strong> to see how CrowdVote works.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="/admin/" 
                   class="bg-crowdvote-blue hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200">
                    üîß Explore Demo Data (Admin)
                </a>
                <a href="/" 
                   class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200">
                    üè† Back to Home
                </a>
            </div>
        </div>

        <!-- Democracy Features Preview -->
        <div class="mt-12 grid md:grid-cols-3 gap-6">
            <div class="text-center">
                <div class="text-4xl mb-3">üó≥Ô∏è</div>
                <h4 class="font-semibold text-gray-800 mb-2">Vote or Delegate</h4>
                <p class="text-gray-600 text-sm">Cast your own vote or delegate to trusted experts</p>
            </div>
            <div class="text-center">
                <div class="text-4xl mb-3">üè∑Ô∏è</div>
                <h4 class="font-semibold text-gray-800 mb-2">Tag-Based Following</h4>
                <p class="text-gray-600 text-sm">Follow different people on different topics</p>
            </div>
            <div class="text-center">
                <div class="text-4xl mb-3">üîç</div>
                <h4 class="font-semibold text-gray-800 mb-2">Complete Transparency</h4>
                <p class="text-gray-600 text-sm">See exactly how every decision was made</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
